# Bazel SmartOS / Illumos / Solaris port

**(Scroll down for original Bazel readme.md)**

This repo contains a SmartOS port of Bazel. It will probably also work on Solaris though it will probably require modifications since we assume the use of pkgsrc.

## Building Bazel on SmartOS

Create a SmartOS container (joyent brand if your on Joyent's public cloud / Triton). To build and use Bazel you need an image which has GCC7. It's easiest to use an image which also uses GCC7 by default. So for example `18.4.0` (`c193a558-1d63-11e9-97cf-97bb3ee5c14f`). 

Install required build packages:

```
# pkgin -y install git-base zip unzip openjdk8 libtool cmake automake ninja-build autoconf gmake gcc7
```

Next we need to download the Bazel distribution and apply the changes of this forked repo. The reason why we need the Bazel distribution and can't simply compile the cloned fork is because in order to compile Bazel you need a working Bazel installation (usually an older version). The Bazel distribution contains things like pre-compiled protobuf messages (ie. java files generated by the protobuf compiler). 

Download `bazel-1.2.1-dist.zip` (the Bazel distribution) from the [Bazel releases](https://github.com/bazelbuild/bazel/releases) page.

Next we will prepare our source tree by putting everything together:

```
# mkdir bazel-1.2.1
# unzip bazel-1.2.1-dist.zip -d bazel-1.2.1
# git clone https://github.com/siepkes/bazel-smartos.git
# cd bazel-smartos
# git checkout smartos-1.2.1
# git format-patch -1
# cd ../bazel-1.2.1
# patch -p1 < ../bazel-smartos/0001-Added-SmartOS-Illumos-Solaris-support.patch
```

We are now ready to build Bazel!

```
# export JAVA_HOME="/opt/local/java/openjdk8"
# export EXTRA_BAZEL_ARGS="--host_javabase=@local_jdk//:jdk"
# ./compile.sh
```

Grab a `<INSERT FAVORITE BEVERAGE HERE>` and wait for the build to complete.

## Debugging Bazel build problems

When encountering issues with building Bazel the following `EXTRA_BAZEL_ARGS` can be set to get more information during the build. See the [Bazel Command Line Reference](https://docs.bazel.build/versions/master/command-line-reference.html) for more flags.

```
# export EXTRA_BAZEL_ARGS="--subcommands --host_javabase=@local_jdk//:jdk"
```

## Known issues

* `bazel/tools/cpp/CROSSTOOL` contains a hardcoded GCC version number in some paths. For example `/opt/local/gcc7/lib/gcc/x86_64-sun-solaris2.11/7.3.0/include-fixed`. This can break with GCC updates.

# [Bazel](https://bazel.build)

*{Fast, Correct} - Choose two*

Build and test software of any size, quickly and reliably.

* **Speed up your builds and tests**:
  Bazel rebuilds only what is necessary.
  With advanced local and distributed caching, optimized dependency analysis and
  parallel execution, you get fast and incremental builds.

* **One tool, multiple languages**: Build and test Java, C++, Android, iOS, Go,
  and a wide variety of other language platforms. Bazel runs on Windows, macOS,
  and Linux.

* **Scalable**: Bazel helps you scale your organization, codebase, and
  continuous integration solution. It handles codebases of any size, in multiple
  repositories or a huge monorepo.

* **Extensible to your needs**: Easily add support for new languages and
  platforms with Bazel's familiar extension language. Share and re-use language
  rules written by the growing Bazel community.

## Getting Started

  * [Install Bazel](https://docs.bazel.build/install.html)
  * [Get started with Bazel](https://docs.bazel.build/getting-started.html)
  * Follow our tutorials:

    - [Build C++](https://docs.bazel.build/tutorial/cpp.html)
    - [Build Java](https://docs.bazel.build/tutorial/java.html)
    - [Android](https://docs.bazel.build/tutorial/android-app.html)
    - [iOS](https://docs.bazel.build/tutorial/ios-app.html)

## Documentation

  * [Bazel command line](https://docs.bazel.build/user-manual.html)
  * [Rule reference](https://docs.bazel.build/be/overview.html)
  * [Use the query command](https://docs.bazel.build/query.html)
  * [Extend Bazel](https://docs.bazel.build/skylark/concepts.html)
  * [Write tests](https://docs.bazel.build/test-encyclopedia.html)
  * [Roadmap](https://bazel.build/roadmap.html)
  * [Who is using Bazel?](https://github.com/bazelbuild/bazel/wiki/Bazel-Users)

## Contributing to Bazel

See [CONTRIBUTING.md](CONTRIBUTING.md)

[![Build status](https://badge.buildkite.com/1fd282f8ad98c3fb10758a821e5313576356709dd7d11e9618.svg?status=master)](https://ci.bazel.build)
